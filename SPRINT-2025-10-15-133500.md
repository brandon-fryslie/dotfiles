# Sprint 2: Documentation Accuracy & Consistency

**Sprint Period:** 1-2 days
**Based on:** STATUS-2025-10-15-133003.md, PLAN-2025-10-15-110000.md
**Previous Sprint:** SPRINT-2025-10-15-110000.md (Sprint 1 - COMPLETE)
**Goal:** Achieve 90%+ project completion by fixing all remaining documentation issues

---

## Sprint Context

### What Changed Since Sprint 1

Sprint 1 **EXCEEDED EXPECTATIONS** (90% grade):
- ✓ **P0-1 COMPLETE**: merge-json.sh now produces correct JSON objects (13 tests passing)
- ✓ **P0-3 COMPLETE**: ./install wrapper script created and tested (5 tests passing)
- ✓ **P2-1 COMPLETE**: Comprehensive test suite delivered (58 tests passing)
- ✓ **P1-2 PARTIAL**: Core justfile commands now work and are tested
- ~ **P0-2 NOT STARTED**: iCloud Drive limitation still not documented
- ~ **P1-1 NOT STARTED**: Phantom commands still in documentation

### Current State (from STATUS-2025-10-15-133003.md)

**Overall Completion:** 85% functional, 15% incomplete

**What Works:**
- Core symlink management: 100% ✓
- Profile system: 100% ✓
- Installation methods: 100% ✓
- JSON merging: 100% fixed ✓
- Test infrastructure: 100% ✓

**What Needs Work:**
- Documentation accuracy: 70% (phantom commands, factual errors)
- Watchers system: 10% (merge-json fixed but launchd broken)

### Why This Sprint Matters

Documentation is the **user's first impression**. If users hit errors following our docs:
- They lose trust in the project
- They can't successfully install
- They waste time debugging phantom commands

This sprint is about **honoring the promise** that our documentation makes to users.

---

## Sprint Objectives

1. **Fix phantom command references** - Users should not encounter "command not found" errors
2. **Document iCloud limitation** - Users should understand why watchers don't work
3. **Fix README factual errors** - Documentation should reflect actual implementation
4. **Verify CLAUDE.md accuracy** - All examples should work as written

**Success Criteria:**
- New user can follow README without encountering any documentation errors
- All justfile command references are valid
- WATCHERS.md has prominent warning about iCloud Drive limitation
- README.md accurately describes tools used (fnm, not Volta)
- CLAUDE.md examples use only commands that exist in justfile

**Out of Scope:**
- No code changes (code is working, tests pass)
- No new features
- Watchers system remains broken (document limitation, fix in future sprint)

---

## Sprint Backlog

### Documentation Fix 1: Remove Phantom Justfile Commands [2 hours]
**Priority:** P1-1 | **Estimated Effort:** 2 hours

#### Current Problem
Documentation references three commands that don't exist:
1. `just add-file-home` - Referenced in CLAUDE.md line 173
2. `just test-home` - Referenced in MIGRATION.md line 151
3. `just validate-yaml` - Referenced in MIGRATION.md line 276

Users attempting these commands get: `error: Justfile does not contain recipe`

#### Evidence from STATUS
- Section: P1-1 (lines 184-211)
- Test validation: `test-justfile-commands.bats: phantom commands from documentation do not exist` - PASS
- This test correctly identifies that commands don't exist, but docs still reference them

#### Tasks
- [ ] **Fix MIGRATION.md line 151**: Change `just test-home` → `just dry-run-home`
- [ ] **Fix MIGRATION.md line 276**: Change `just validate-yaml` → `just validate`
- [ ] **Fix CLAUDE.md line 173**: Remove `just add-file-home` example, use manual method
- [ ] **Verify justfile list**: Run `just --list` and cross-reference with all documentation
- [ ] **Search for other phantom commands**: `grep -r "just [a-z-]*" *.md | grep -v "just install\|just status\|just verify"`

#### Implementation

**MIGRATION.md line 151:**
```diff
-just test-home
+just dry-run-home
```

**MIGRATION.md line 276:**
```diff
-just validate-yaml
+just validate
```

**CLAUDE.md lines 167-177:**
```diff
-**Using justfile (recommended):**
-```bash
-# 1. Create the file
-echo "config content" > dotfiles-home/newconfig
-
-# 2. Add to configuration
-just add-file-home newconfig
-
-# 3. Install
-just install-home
-```

+**Manual method:**
+```bash
+# 1. Create the file
+echo "config content" > dotfiles-home/newconfig
+
+# 2. Add to configuration file
+echo "  ~/.newconfig: dotfiles-home/newconfig" >> install-home.conf.yaml
+
+# 3. Install
+just install-home
+```
```

#### Acceptance Criteria
- [ ] No references to `add-file-home` in any .md file
- [ ] `test-home` replaced with `dry-run-home` everywhere
- [ ] `validate-yaml` replaced with `validate` everywhere
- [ ] All documented justfile commands exist: `just --list | grep <command>`
- [ ] User can follow CLAUDE.md "Adding New Dotfiles" without errors

#### Testing
```bash
# Verify no phantom commands remain
grep -r "add-file-home" *.md  # Should return nothing
grep -r "test-home" *.md      # Should return nothing
grep -r "validate-yaml" *.md  # Should return nothing

# Verify replacements work
just dry-run-home   # Should show dry run output
just validate       # Should validate YAML files
```

---

### Documentation Fix 2: Add iCloud Drive Warning to WATCHERS.md [1 hour]
**Priority:** P0-2 (was Critical, now documentation-only) | **Estimated Effort:** 1 hour

#### Current Problem
WATCHERS.md documents a complete file watching system, but:
- launchd cannot execute scripts from iCloud Drive (macOS security restriction)
- No warning about this limitation anywhere in documentation
- Users setting up watchers will experience silent failures with no explanation
- Repository is currently in iCloud Drive: `/Users/bmf/Library/Mobile Documents/com~apple~CloudDocs/_mine/icode/dotfiles`

#### Evidence from STATUS
- Section: P0-2 (lines 120-138)
- Status: NOT ADDRESSED
- Impact: "Users attempting to use watchers will encounter silent failures with no explanation"

#### Tasks
- [ ] **Add warning section** at top of WATCHERS.md (after introduction)
- [ ] **Document three solutions** for users who need watchers
- [ ] **Update Testing Your Setup** section to mention iCloud check
- [ ] **Add to README** brief note that watchers require non-iCloud location

#### Implementation

Add to WATCHERS.md after line 22 (after "What This System Does"):

```markdown
## ⚠️ CRITICAL: iCloud Drive Limitation

**The watchers system currently does not function when the dotfiles repository is stored in iCloud Drive.**

### Why This Happens

macOS launchd agents require Full Disk Access permission to execute scripts located in iCloud Drive directories (`~/Library/Mobile Documents/`). This is a security restriction that cannot be bypassed without granting system-wide permissions.

**Current repository location:** `~/Library/Mobile Documents/com~apple~CloudDocs/_mine/icode/dotfiles` (iCloud Drive)

### Impact

If you attempt to set up watchers while the repository is in iCloud Drive:
- launchd agents will fail to load with "Operation not permitted" errors
- File changes will not trigger merges
- No error messages will appear in normal operation
- You'll need to check Console.app logs to see permission errors

### Solutions

**Option 1: Move Repository Outside iCloud Drive [RECOMMENDED]**
```bash
# Move to local directory
mv ~/Library/Mobile\ Documents/com~apple~CloudDocs/_mine/icode/dotfiles ~/icode/dotfiles
cd ~/icode/dotfiles
just install-home  # Re-install symlinks
```

**Option 2: Copy Scripts to Non-iCloud Location [COMPLEX]**
- Modify `setup-watchers.sh` to copy scripts to `~/.local/bin/` or `~/bin/`
- Update launchd plists to reference copied scripts
- Maintain two copies of scripts (development risk)

**Option 3: Use Alternative File Watching [FUTURE]**
- Replace launchd with `fswatch` (no permission issues)
- Requires architecture change
- Not currently implemented

### Checking Your Installation

To check if you're affected:
```bash
# Check repository location
pwd
# If output contains "Mobile Documents" or "iCloud", watchers won't work

# Alternative: check if in iCloud
[[ "$(pwd)" =~ "Library/Mobile Documents" ]] && echo "⚠️ In iCloud Drive - watchers will not work" || echo "✓ Not in iCloud - watchers should work"
```

### Recommendation

**For now, do NOT attempt to use the watchers system if your repository is in iCloud Drive.** Either move the repository to a local directory or wait for a future architecture update.

This limitation will be addressed in a future sprint. See GitHub issues for progress.

---
```

Add to README.md after line 53 (in "Navigation & File Management" section):

```markdown

### File Watching System (Experimental)
- **Note:** Currently non-functional when repository is in iCloud Drive
- See `WATCHERS.md` for details and limitations
```

#### Acceptance Criteria
- [ ] Warning appears prominently at top of WATCHERS.md
- [ ] Warning explains WHY it doesn't work (not just that it doesn't)
- [ ] Three solution options provided with pros/cons
- [ ] Command to check if affected by limitation
- [ ] README.md mentions limitation
- [ ] User understands this is a known limitation, not their mistake

#### Testing
```bash
# Verify warning is present
grep -i "icloud" WATCHERS.md | head -1  # Should show warning section

# Verify check command works
[[ "$(pwd)" =~ "Library/Mobile Documents" ]] && echo "In iCloud" || echo "Not in iCloud"

# Verify README mentions limitation
grep -i "experimental\|non-functional" README.md | grep -i "watcher"
```

---

### Documentation Fix 3: Correct README.md Factual Errors [1.5 hours]
**Priority:** P1-5 | **Estimated Effort:** 1.5 hours

#### Current Problem
README.md contains factual inaccuracies:
1. **Line 44**: Claims "Volta for version management" but Volta is commented out in zshrc
2. **Line 130**: File tree may not reflect new ./install script
3. **Line 172**: References `./install -v` but script doesn't support -v flag

Actually uses: fnm (preferred), NVM (fallback), bun

#### Evidence from STATUS
- Section: P1-5 (lines 279-305)
- Evidence: `grep "Volta" README.md` vs `grep -A2 "volta" dotfiles-home/zshrc`
- Reality: Volta is commented out, fnm is active

#### Tasks
- [ ] **Fix line 44**: Change "Volta" to "fnm (preferred), NVM, and bun"
- [ ] **Verify file tree**: Check if ./install script is listed (it now exists per P0-3)
- [ ] **Fix line 172**: Remove `-v` flag reference or verify script supports it
- [ ] **Audit all tool claims**: Compare README claims with actual dotfiles-home/zshrc
- [ ] **Check for other inaccuracies**: Read entire README against current implementation

#### Implementation

**Line 44:**
```diff
-### Language & Runtime Management
-- **Python** with pyenv for version management
-- **Node.js** with Volta for version management
-- **Java** with SDKMAN for version management
-- **Ruby** with RVM support
-- **pnpm** for Node.js package management
+### Language & Runtime Management
+- **Python** with pyenv for version management
+- **Node.js** with fnm (preferred), NVM, and bun for version management
+- **Java** with SDKMAN for version management
+- **Ruby** with RVM support
+- **pnpm** for Node.js package management
```

**Line 130 (file tree) - Verify includes:**
```
├── install                 # Interactive installation script
```

**Line 172:**
```diff
-3. Run the installation with verbose output: `./install -v`
+3. Ensure the Dotbot submodule is initialized: `just init`
```

#### Acceptance Criteria
- [ ] README.md accurately describes Node.js version managers
- [ ] File tree matches actual repository structure
- [ ] All tool claims verified against actual dotfiles
- [ ] No references to unsupported flags or options
- [ ] User reading README gets accurate picture of what's installed

#### Testing
```bash
# Verify tool accuracy
grep "fnm" dotfiles-home/zshrc     # Should be present and active
grep "volta" dotfiles-home/zshrc   # Should be commented out
grep "Volta" README.md            # Should NOT appear

# Verify file tree accuracy
for file in install install.conf.yaml install-home.conf.yaml justfile; do
  [[ -f "$file" ]] || echo "Missing: $file"
done

# Verify install script options
./install --help 2>&1 | grep -i verbose  # Should NOT support -v flag
```

---

### Documentation Fix 4: Verify and Update CLAUDE.md Accuracy [1 hour]
**Priority:** P1-1 (related) | **Estimated Effort:** 1 hour

#### Current Problem
CLAUDE.md is the **primary guide for AI assistants** working on this repo. If it contains inaccuracies, AI assistants will make incorrect assumptions and generate wrong code.

Need to verify:
1. All command examples work
2. All file paths exist
3. All code snippets are accurate
4. Architecture descriptions match implementation

#### Evidence from STATUS
- Section: Multiple (documentation theme throughout)
- Line 34: Says `install` was "removed" but it now exists (created in Sprint 1)
- Need comprehensive audit

#### Tasks
- [ ] **Update line 34**: `install` script now exists (created in P0-3)
- [ ] **Verify all command examples**: Test each `just` command shown
- [ ] **Verify all file paths**: Check that referenced files exist
- [ ] **Verify code snippets**: Ensure they match actual implementation
- [ ] **Check architecture descriptions**: Profile system, configuration composition
- [ ] **Update any outdated information** from Sprint 1 changes

#### Implementation

**Line 34:**
```diff
-### Legacy Scripts (Deprecated)
-
-Both old installation scripts are deprecated:
-- `install` (custom wrapper script) - removed
-- `install_dotfiles.sh` (old custom script) - see `MIGRATION.md`
+### Installation Methods
+
+**Current method:** Use justfile commands or `./install` script
+
+**Legacy script:** `install_dotfiles.sh` - deprecated, see `MIGRATION.md` for migration guide
```

**Lines 167-177:** (Already updated in Fix 1)

#### Acceptance Criteria
- [ ] CLAUDE.md accurately describes current installation methods
- [ ] All command examples tested and work
- [ ] All file path references are valid
- [ ] Architecture descriptions match implementation
- [ ] Document reflects changes from Sprint 1 (./install now exists, tests exist)

#### Testing
```bash
# Test all command examples in CLAUDE.md
grep "^just " CLAUDE.md | while read cmd; do
  echo "Testing: $cmd"
  $cmd --help 2>&1 || echo "Failed: $cmd"
done

# Verify file paths
grep "dotfiles-home/\|dotfiles-work/\|dotfiles_global/" CLAUDE.md | \
  sed 's/.*\(dotfiles[_-][a-z]*/\([^: ]*\).*/\1\2/' | \
  while read path; do
    [[ -e "$path" ]] || echo "Missing: $path"
  done

# Verify ./install exists
[[ -f "./install" ]] || echo "ERROR: ./install script missing (should exist per P0-3)"
```

---

### Optional: Add Documentation Tests [2 hours]
**Priority:** P2 (Optional Enhancement) | **Estimated Effort:** 2 hours

#### Rationale
Prevent documentation from becoming stale again. Add tests that validate:
- All documented commands exist
- All documented files exist
- Examples in documentation actually work

#### Tasks
- [ ] **Create test-documentation.bats**: New test file
- [ ] **Test 1**: All justfile commands referenced in docs exist in justfile
- [ ] **Test 2**: All file paths referenced in docs exist
- [ ] **Test 3**: README installation instructions work
- [ ] **Test 4**: CLAUDE.md examples work
- [ ] **Add to CI**: Include in `just test` suite

#### Implementation

Create `tests/functional/test-documentation.bats`:

```bash
#!/usr/bin/env bats

load '../helpers/test-helpers'

@test "all justfile commands in CLAUDE.md exist" {
    # Extract just commands from CLAUDE.md
    commands=$(grep -E "^\s*just [a-z-]+" CLAUDE.md | sed 's/.*just \([a-z-]*\).*/\1/' | sort -u)

    for cmd in $commands; do
        just --list | grep -q "^$cmd" || fail "Command 'just $cmd' in CLAUDE.md does not exist"
    done
}

@test "all justfile commands in README.md exist" {
    commands=$(grep -E "just [a-z-]+" README.md | sed 's/.*just \([a-z-]*\).*/\1/' | sort -u)

    for cmd in $commands; do
        just --list | grep -q "^$cmd" || fail "Command 'just $cmd' in README.md does not exist"
    done
}

@test "all file paths in CLAUDE.md exist" {
    # This is a simplified check - extend as needed
    grep -E "install.*\.conf\.yaml" CLAUDE.md | \
        sed 's/.*\(install[^.]*\.conf\.yaml\).*/\1/' | \
        sort -u | \
        while read file; do
            [[ -f "$file" ]] || fail "File $file referenced in CLAUDE.md does not exist"
        done
}

@test "WATCHERS.md contains iCloud warning" {
    grep -i "icloud" WATCHERS.md | grep -qi "limitation\|warning\|critical" || \
        fail "WATCHERS.md missing iCloud Drive warning"
}

@test "README.md does not claim Volta is used" {
    ! grep -q "Volta for version management" README.md || \
        fail "README.md incorrectly claims Volta is used"
}

@test "README.md mentions fnm for Node.js" {
    grep -q "fnm" README.md || \
        fail "README.md does not mention fnm (actual Node.js version manager)"
}

@test "./install script exists and is executable" {
    [[ -f "./install" ]] || fail "./install script does not exist"
    [[ -x "./install" ]] || fail "./install script is not executable"
}
```

#### Acceptance Criteria
- [ ] Test file created and integrated into test suite
- [ ] All documentation tests pass
- [ ] Tests run as part of `just test`
- [ ] Tests would catch future documentation drift

#### Testing
```bash
just test  # Should include new documentation tests
bats tests/functional/test-documentation.bats  # Run just doc tests
```

---

## Sprint Deliverables

### Required Deliverables
1. ✅ **MIGRATION.md** - Phantom commands fixed (test-home → dry-run-home, validate-yaml → validate)
2. ✅ **CLAUDE.md** - Phantom command removed, installation method updated, add-file-home example changed to manual
3. ✅ **WATCHERS.md** - Prominent iCloud Drive limitation warning with solutions
4. ✅ **README.md** - Volta → fnm, file tree accurate, troubleshooting fixed
5. ✅ **Documentation consistency** - No contradictions between files

### Optional Deliverable
6. 🔲 **test-documentation.bats** - Automated tests to prevent documentation drift

---

## Testing Checklist

### Pre-Sprint Verification
- [ ] Current STATUS is 85% complete (confirmed: STATUS-2025-10-15-133003.md)
- [ ] All Sprint 1 items marked complete (confirmed: P0-1, P0-3, P2-1)
- [ ] 58 tests passing (confirmed in STATUS)

### Documentation Accuracy Tests
- [ ] No phantom commands: `grep -r "add-file-home\|test-home\|validate-yaml" *.md` returns nothing or corrected forms
- [ ] All documented justfile commands exist: `just --list` contains all commands referenced in docs
- [ ] README installation instructions work: Fresh clone test succeeds
- [ ] CLAUDE.md examples work: Test each code snippet
- [ ] WATCHERS.md has iCloud warning: `grep -i "icloud" WATCHERS.md` shows warning section

### Consistency Tests
- [ ] README and CLAUDE.md agree on installation method
- [ ] README and CLAUDE.md agree on available tools (fnm not Volta)
- [ ] WATCHERS.md and README both mention limitation
- [ ] No conflicting information between documents

### User Experience Tests
- [ ] New user can install from README without hitting phantom commands
- [ ] User attempting watchers sees warning before trying
- [ ] User adding new dotfile can follow CLAUDE.md instructions
- [ ] User knows which version managers are actually installed

---

## Success Metrics

### Sprint Completion Criteria
- [ ] All P1 documentation items complete (P1-1, P1-3, P1-5)
- [ ] P0-2 documented (iCloud warning added)
- [ ] No user-facing documentation errors remain
- [ ] Project completion: 90%+ (up from 85%)

### Quality Metrics
- **Documentation fixes:** 4+ files updated (CLAUDE.md, README.md, MIGRATION.md, WATCHERS.md)
- **User errors prevented:** 3 phantom commands removed
- **Warnings added:** 1 critical (iCloud Drive)
- **Test coverage:** 58 tests continue passing, optionally +6 documentation tests

### User Impact
- **Before Sprint 2:** User hits "command not found" errors, watchers fail silently
- **After Sprint 2:** User can follow all documentation successfully, knows about limitations

---

## Risk Assessment

### Low-Risk Items (Documentation Only)
- Fixing phantom commands: Simple find/replace
- Correcting factual errors: Straightforward updates
- Adding iCloud warning: Pure addition, no changes to existing content

### Risks
**Risk 1: Finding More Documentation Errors During Audit**
- **Likelihood:** Medium
- **Impact:** Extends sprint by a few hours
- **Mitigation:** Budget extra time on Day 2 for discoveries

**Risk 2: CLAUDE.md Changes Affecting AI Assistant Behavior**
- **Likelihood:** Low
- **Impact:** Minor (AI will use more accurate information)
- **Mitigation:** Review changes ensure they're improvements

**Risk 3: User Expectations About Watchers**
- **Likelihood:** Medium (users may want watchers to work)
- **Impact:** Medium (need to manage expectations)
- **Mitigation:** Clear warning that solution coming in future sprint

---

## Timeline & Effort Estimates

### Day 1 (4-5 hours)
- **Morning (2 hours):** Fix phantom commands (P1-1)
  - Update MIGRATION.md
  - Update CLAUDE.md
  - Test all changes

- **Afternoon (2-3 hours):** Add iCloud warning (P0-2) + Fix README (P1-5)
  - Write and add warning to WATCHERS.md
  - Update README.md mention
  - Fix Volta → fnm in README
  - Fix file tree in README

### Day 2 (2-3 hours)
- **Morning (1 hour):** Verify CLAUDE.md accuracy (P1-1 related)
  - Test all command examples
  - Update installation method description
  - Verify architecture descriptions

- **Afternoon (1-2 hours):** Testing & verification
  - Run all documentation tests
  - Fresh clone test
  - Consistency checks

### Optional Day 2 Afternoon (2 hours)
- **If time permits:** Add documentation tests
  - Create test-documentation.bats
  - Integrate into test suite
  - Verify tests catch documentation issues

**Total Estimated Effort:** 6-8 hours (1-2 days)

---

## Definition of Done

### For Each Documentation Fix
- [ ] Change made in correct file(s)
- [ ] All instances of error corrected (not just first occurrence)
- [ ] Related documentation updated for consistency
- [ ] Tested that fix works (command exists, file exists, etc.)

### For Sprint
- [ ] All required deliverables complete
- [ ] No phantom commands remain in documentation
- [ ] iCloud warning prominent in WATCHERS.md
- [ ] README.md factually accurate
- [ ] CLAUDE.md matches current implementation
- [ ] 58 tests still passing (no regressions)
- [ ] Fresh clone test succeeds following README exactly

### Quality Gates
- [ ] No new issues introduced
- [ ] No contradictions between documentation files
- [ ] User can successfully follow installation instructions
- [ ] Project completion: 90%+

---

## Retrospective Questions

After sprint completion, reflect on:

1. **Did we find more documentation issues than expected?**
2. **Was the iCloud warning clear enough?**
3. **Should we have added documentation tests?**
4. **Are we ready to tackle watchers system in Sprint 3?**
5. **What's the priority: fix watchers or add CI/CD?**

---

## Next Sprint Preview

### Sprint 3 Options

**Option A: Fix Watchers System (1-2 weeks)**
- Implement iCloud workaround (copy scripts to ~/.local/bin)
- Test end-to-end watcher functionality
- Update WATCHERS.md examples with real output
- Add validation to merge-json.sh

**Option B: Add CI/CD Pipeline (1 week)**
- GitHub Actions workflow
- Run tests on every push
- Validate documentation (using tests from Sprint 2)
- Lint shell scripts
- Badge in README

**Option C: Polish & Enhancement (1 week)**
- Add troubleshooting guide
- Enhance status command
- Add backup/restore tests
- Standardize error handling

**Recommendation:** Option B (CI/CD) - Prevent future regressions before adding more features. Watchers can wait until after we have automated quality checks.

---

## Notes

### Why This Sprint is Valuable

This might seem like "just documentation," but:
1. **User trust:** First impression matters. Errors in docs = distrust of project
2. **AI accuracy:** CLAUDE.md guides AI assistants. Bad docs = bad AI suggestions
3. **Maintenance:** Without accurate docs, future changes are risky
4. **Completeness:** Can't call project "done" with known documentation errors

### Why Keep It Focused

- **No feature creep:** Resist temptation to "quickly fix" code issues
- **No architecture changes:** Save watchers decision for dedicated sprint
- **Documentation only:** Stay focused on alignment between docs and reality

### Why Document iCloud Limitation

- **Users need to know WHY** watchers don't work, not just that they don't
- **Provide path forward** - show solutions, don't just complain
- **Manage expectations** - this is temporary, solution coming

---

**Sprint Start:** 2025-10-15
**Sprint End:** 2025-10-16 or 2025-10-17 (1-2 days)
**Sprint Review:** Verify documentation accuracy with fresh eyes
**Sprint Retro:** Discuss whether to add CI/CD next or fix watchers
