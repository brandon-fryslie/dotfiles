#!/usr/bin/env bash
# install - Interactive Dotbot installation wrapper
# Usage: ./install [home|work|base]

set -euo pipefail

BASEDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOTBOT_DIR="dotbot"
DOTBOT_BIN="bin/dotbot"

cd "${BASEDIR}"

PROFILE="${1:-home}"

if [[ -z "$PROFILE" ]]; then
  echo "Usage: ./install [home|work|base]"
  echo ""
  echo "Profiles:"
  echo "  home   - Personal development environment"
  echo "  work   - Work environment"
  echo "  base   - Base configuration only"
  exit 2
fi

# Run dotbot with the specified configuration files
run_dotbot() {
  local description="$1"
  shift
  local configs=("$@")

  echo "Installing ${description}..."

  local config_args=()
  for config in "${configs[@]}"; do
    config_args+=(-c "$config")
  done

  "${BASEDIR}/${DOTBOT_DIR}/${DOTBOT_BIN}" -d "${BASEDIR}" "${config_args[@]}"
}

case "$PROFILE" in
  home)
    run_dotbot "base configuration" install-base.conf.yaml
    run_dotbot "home profile" install-home.conf.yaml
    run_dotbot "rad-shell configuration" install-rad.conf.yaml
    run_dotbot "claude configuration" install-claude.conf.yaml
    ;;
  work)
    run_dotbot "base configuration" install-base.conf.yaml
    run_dotbot "work profile" install-work.conf.yaml
    run_dotbot "claude configuration" install-claude.conf.yaml
    ;;
  base)
    run_dotbot "base configuration" install-base.conf.yaml
    ;;
  *)
    run_dotbot "base configuration" install-base.conf.yaml
    run_dotbot "${PROFILE} profile" "install-${PROFILE}.conf.yaml"
    ;;
esac

echo "âœ“ Installation complete!"
