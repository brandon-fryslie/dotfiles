     1→/**
     2→ * Canonical Type System for Oscilla v2.5
     3→ *
     4→ * This module implements the 5-axis type system as specified in:
     5→ * design-docs/spec/CANONICAL-ARCHITECTURE-oscilla-v2.5-20260109-160000.md
     6→ *
     7→ * The type system separates concerns into:
     8→ * - PayloadType: What the value is made of (float, vec2, color, etc.)
     9→ * - Extent: Where/when/about-what a value exists (5 independent axes)
    10→ * - CanonicalType: Complete type contract (payload + extent + unit)
    11→ * - NumericUnit: Optional unit annotation for numeric types (phase, radians, etc.)
    12→ *
    13→ * Key design principles:
    14→ * - No optional fields - use discriminated unions (AxisTag pattern)
    15→ * - Runtime erasure - all type info resolved at compile time
    16→ * - Single source of truth - this is the authoritative type system
    17→ */
    18→
    19→// =============================================================================
    20→// Unit - Closed Discriminated Union (Spec §A3)
    21→// =============================================================================
    22→
    23→/**
    24→ * Unit annotation for typed values.
    25→ *
    26→ * Every typed value has (payload, unit, extent). Unit is ALWAYS present.
    27→ * Units are semantic, not representational: phase01 != scalar even though
    28→ * both are float32 at runtime.
    29→ *
    30→ * Spec Reference: 0-Units-and-Adapters.md §A3
    31→ */
    32→export type Unit =
    33→  | { readonly kind: 'none' }         // For payloads without units (bool, shape)
    34→  | { readonly kind: 'scalar' }       // Dimensionless numeric
    35→  | { readonly kind: 'norm01' }       // Clamped [0, 1]
    36→  | { readonly kind: 'phase01' }      // Cyclic [0, 1) with wrap semantics
    37→  | { readonly kind: 'radians' }      // Angle in radians
    38→  | { readonly kind: 'degrees' }      // Angle in degrees
    39→  | { readonly kind: 'deg' }          // Alias for degrees (camera spec uses 'deg')
    40→  | { readonly kind: 'ms' }           // Milliseconds
    41→  | { readonly kind: 'seconds' }      // Seconds
    42→  | { readonly kind: 'count' }        // Integer count/index
    43→  | { readonly kind: 'ndc2' }         // Normalized device coords vec2 [0,1]^2
    44→  | { readonly kind: 'ndc3' }         // Normalized device coords vec3 [0,1]^3
    45→  | { readonly kind: 'world2' }       // World-space vec2
    46→  | { readonly kind: 'world3' }       // World-space vec3
    47→  | { readonly kind: 'rgba01' }       // Float color RGBA each in [0,1]
    48→  | { readonly kind: 'var'; readonly id: string };  // Unresolved unit variable (must be resolved by constraint solver)
    49→
    50→// --- Unit Constructors ---
    51→export function unitNone(): Unit { return { kind: 'none' }; }
    52→export function unitScalar(): Unit { return { kind: 'scalar' }; }
    53→export function unitNorm01(): Unit { return { kind: 'norm01' }; }
    54→export function unitPhase01(): Unit { return { kind: 'phase01' }; }
    55→export function unitRadians(): Unit { return { kind: 'radians' }; }
    56→export function unitDegrees(): Unit { return { kind: 'degrees' }; }
    57→export function unitDeg(): Unit { return { kind: 'deg' }; }
    58→export function unitMs(): Unit { return { kind: 'ms' }; }
    59→export function unitSeconds(): Unit { return { kind: 'seconds' }; }
    60→export function unitCount(): Unit { return { kind: 'count' }; }

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
