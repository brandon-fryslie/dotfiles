# Option 3: Show last command in status bar
# This uses tmux hooks to display what's happening

# Enable extended status bar with command display
set -g status-right-length 200
set -g status-left-length 50

# Debug binding - Ctrl-b H (shift+h) to run debug script
bind-key H run-shell '$HOME/.config/tmux/scripts/tmux-help-debug.sh'

# Toggle help pane with Ctrl-b h
# Creates a 5-line pane at the bottom showing shortcuts
bind-key h run-shell '$HOME/.config/tmux/scripts/tmux-help-toggle.sh'

# Custom status bar that shows last action
set -g status-left '[#S] '
set -g status-right '#{?client_prefix,#[reverse] PREFIX #[noreverse] ,}#[fg=yellow]#{?#{!=:#{@last_action},},#{@last_action} | ,}#[fg=white]%H:%M %d-%b'

# Utility function: Set last action message
# Usage: run-shell "tmux set -g @last_action 'your message here'"

# Pane navigation with status updates
bind-key o select-pane -t :.+ \; set -g @last_action "→ next-pane"
bind-key \; last-pane \; set -g @last_action "← last-pane"
bind-key Up select-pane -U \; set -g @last_action "↑ pane-up"
bind-key Down select-pane -D \; set -g @last_action "↓ pane-down"
bind-key Left select-pane -L \; set -g @last_action "← pane-left"
bind-key Right select-pane -R \; set -g @last_action "→ pane-right"

# Pane management
bind-key % split-window -h -c "#{pane_current_path}" \; set -g @last_action "⫽ split-h"
bind-key '"' split-window -v -c "#{pane_current_path}" \; set -g @last_action "⫼ split-v"
bind-key x confirm-before -p "kill-pane #P? (y/n)" kill-pane \; set -g @last_action "✕ kill-pane"
bind-key z resize-pane -Z \; set -g @last_action "⬢ zoom-toggle"
bind-key ! break-pane \; set -g @last_action "⧉ break-pane"

# Window management
bind-key c new-window -c "#{pane_current_path}" \; set -g @last_action "⊕ new-window"
bind-key & confirm-before -p "kill-window #W? (y/n)" kill-window \; set -g @last_action "✕ kill-window"
bind-key n next-window \; set -g @last_action "→ next-window"
bind-key p previous-window \; set -g @last_action "← prev-window"
bind-key l last-window \; set -g @last_action "↔ last-window"

# Session management
bind-key d detach-client
bind-key ( switch-client -p \; set -g @last_action "← prev-session"
bind-key ) switch-client -n \; set -g @last_action "→ next-session"

# Copy mode
bind-key [ copy-mode \; set -g @last_action "⎘ copy-mode"
bind-key ] paste-buffer \; set -g @last_action "⎘ paste"

# Resize panes
bind-key -r C-Up resize-pane -U 5 \; set -g @last_action "↑ resize-up"
bind-key -r C-Down resize-pane -D 5 \; set -g @last_action "↓ resize-down"
bind-key -r C-Left resize-pane -L 5 \; set -g @last_action "← resize-left"
bind-key -r C-Right resize-pane -R 5 \; set -g @last_action "→ resize-right"

# Misc
bind-key r source-file ~/.config/tmux/tmux.conf \; set -g @last_action "⟲ reload-config"
bind-key Space next-layout \; set -g @last_action "◫ next-layout"

# Clear last action after 3 seconds (optional)
# This requires a background process, commenting out for now
# set-hook -g after-select-pane 'run-shell -b "sleep 3 && tmux set -g @last_action \"\""'
